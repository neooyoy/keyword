<style>
    .msg-li {
        height: 35px;
    }

    .aaa {
        padding: 5px 5px;
    }
</style>
<!--BEGIN BACK TO TOP-->
<a id="totop" href="#"><i class="fa fa-up"></i></a>
<!--END BACK TO TOP-->

<!--BEGIN TOPBAR-->
<div id="header-topbar-option-demo" class="page-header-topbar">
    <nav id="topbar" role="navigation" style="margin-bottom: 0; z-index: 2;"
         class="navbar navbar-default navbar-static-top">
        <div class="navbar-header">
            <button type="button" data-toggle="collapse" data-target=".sidebar-collapse" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a id="logo" href="${base}/" class="navbar-brand">
                <span class="fa fa-rocket"></span>
                <span class="logo-text">经纪人房源管理</span>
                <span style="display: none" class="logo-text-icon">Office</span>
            </a>
        </div>
        <div class="topbar-main">
            <a id="menu-toggle" href="#" class="hidden-xs"><i class="fa fa-bars"></i></a>
            <ul class="nav navbar navbar-top-links navbar-right mbn">
                <li class="dropdown topbar-user">
                    <a data-hover="dropdown" href="#" class="dropdown-toggle">
                        <i class="fa fa-personalCenter"></i>&nbsp;
                        <span class="hidden-xs">${user.fullname}[#if user.roleName??](${user.roleName})[/#if]</span>
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu dropdown-user pull-right">
                        <li><a href="#" onclick="openModifyUserModal_top()"><i class="fa"></i>修改信息</a>
                        <li><a href="${base}/logoutxiezilou"><i class="fa"></i>退出</a>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>
</div>

<div class="modal fade" id="myModal-user_top" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="panel">
                    <div class="panel-heading">
                        修改信息
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="false">
                            ×
                        </button>
                    </div>

                    <input type="hidden" id="userId_top" value="${user.id}">

                    <div class="panel-body">
                        <!--<div class="form-inline">
                            <div class="form-group modal-open">
                                <label class="pull-left"><span class="cal-group-title">角色</span><span
                                        class="text-red">*</span>：</label>
                                <select id="user_role_top" class="form-control pull-left"
                                        level="1"
                                        id="Sel-invalid" style="width: 340px !important">
                                    <option value="0" selected>普通用户</option>
                                    <option value="1">管理员</option>
                                </select>
                            </div>
                        </div>-->

                        <div class="form-inline moreInvalidDiv">
                            <div class="form-group modal-open">
                                <label class="pull-left"><span class="cal-group-title">用户中文名</span><span
                                        class="text-red">*</span>：</label>
                                <input id="user_fullname_top" type="text" class="form-control" value="${user.fullname}"
                                       style="width: 340px !important"/>
                            </div>
                        </div>

                        <div class="form-inline moreInvalidDiv">
                            <div class="form-group modal-open">
                                <label class="pull-left"><span class="cal-group-title">登录名</span><span
                                        class="text-red">*</span>：</label>
                                <input id="user_loginname_top" type="text" class="form-control" value="${user.loginname}"
                                       style="width: 340px !important"/>
                            </div>
                        </div>

                        <div class="form-inline moreInvalidDiv">
                            <div class="form-group modal-open">
                                <label class="pull-left"><span class="cal-group-title">邮箱</span><span
                                        class="text-red">*</span>：</label>
                                <input value="${user.email}" id="email_top" type="text" class="form-control" style="width: 340px !important"/>
                            </div>
                        </div>

                        <div class="form-inline moreInvalidDiv">
                            <div class="form-group modal-open">
                                <label class="pull-left"><span class="cal-group-title">手机</span><span
                                        class="text-red">*</span>：</label>
                                <input value="${user.cellPhone}" id="cellPhone_top" type="text" class="form-control"
                                       style="width: 340px !important"/>
                            </div>
                        </div>

                        <div class="form-inline moreInvalidDiv">
                            <div class="form-group modal-open">
                                <label class="pull-left"><span class="cal-group-title">密码</span>：</label>
                                <input id="password_top" type="password" class="form-control"
                                       style="width: 340px !important"/>
                            </div>
                        </div>

                        <div class="form-inline moreInvalidDiv">
                            <div class="form-group modal-open">
                                <label class="pull-left"><span class="cal-group-title">确认密码</span>：</label>
                                <input id="re_password_top" type="password" class="form-control"
                                       style="width: 340px !important"/>
                            </div>
                        </div>

                        <div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary" id="btnOK"
                                        onclick="comfirm_top()">确定
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    function openModifyUserModal_top() {
//        $('#user_role_top').val("${user.roleId}");
/*        $('#email_top').val(${user.email});
        $('#cellPhone_top').val(${user.cellPhone});
        $('#password_top').val('');
        $('#re_password_top').val('');

        $('#user_fullname_top').val(${user.fullname});
        $('#user_loginname_top').val(${user.loginname});*/
        $('#user_loginname_top').attr("disabled", true);

        $('#myModal-user_top').modal('show');
    }

    function comfirm_top() {

        if (!isTrueName($('#user_fullname_top').val().trim())) {
            alert('请输入正确的用户中文名');
            return false;
        }

        if (!isPhone($('#cellPhone_top').val().trim())) {
            alert('请输入正确的手机号');
            return false;
        }

        if (!isEmail($('#email_top').val().trim())) {
            alert('请输入正确的邮箱');
            return false;
        }

        if ($('#password_top').val().trim() != '' || $('#re_password_top').val().trim() != '') {
            if (!isPasswd($('#password_top').val())) {
                alert('请输入正确的密码: 只能输入6-20个字母、数字、下划线 ');
                return false;
            }

            if ($('#password_top').val().trim() != $('#re_password_top').val().trim()) {
                alert('两次输入的密码不一致，请重新输入 ');
                return false;
            }
        }

        $.post("${base}/system/modifyUser",
                {
                    'id': $('#userId_top').val(),
//                    'roleId': $('#user_role_top').val(),
                    'email': $('#email_top').val().trim(),
                    'cellPhone': $('#cellPhone_top').val().trim(),
                    'password': $('#password_top').val().trim(),
                    'fullname': $('#user_fullname_top').val().trim(),
                    'loginname': $('#user_loginname_top').val().trim()
                },
                function (result) {
                    if (result.success) {
                        alert(result.message);

                        $('#myModal-user_top').modal('hide');

                        window.location.reload();
                    } else {
                        alert(result.message);
                    }
                });
    }

</script>

<script type="text/javascript" src="${jspath}/resources/js/topnotice/top.js"></script>
<!--END TOPBAR-->


